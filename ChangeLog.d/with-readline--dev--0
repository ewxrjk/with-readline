# do not edit -- automatically generated by arch changelog
# arch-tag: automatic-ChangeLog--rjk@greenend.org.uk--2004/with-readline--dev--0
#

2005-03-30 19:38:14 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-37

    Summary:
      posix_openpt
    Revision:
      with-readline--dev--0--patch-37

    * pty-unix98.c: use posix_openpt() instead of opening ptmx device
      directly.
    * posix_openpt.c: replacement posix_openpt() for platforms that lack it
    * configure.ac: define _XOPEN_SOURCE and check for posix_openpt

    new files:
     posix_openpt.c

    modified files:
     ChangeLog.d/with-readline--dev--0 configure.ac pty-unix98.c


2005-03-28 17:12:21 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-36

    Summary:
      bsd build fixes
    Revision:
      with-readline--dev--0--patch-36

    * with-readline.h: work around libutils's xmalloc symbol as for xrealloc

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.h


2005-03-27 18:20:22 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-35

    Summary:
      save history to a file
    Revision:
      with-readline--dev--0--patch-35

    * with-readline.c: save history to $HOME/.<app>_history
                       honor $HISTFILESIZE
                       --history option overrides $HISTFILESIZE
                       History is saved after every line, rather than on
                       termination, so that ungraceful termination does not
                       mean that you lose a chunk of history.
    * util.c: xmalloc function
    * with-readline.1: document saved history support

    modified files:
     ChangeLog.d/with-readline--dev--0 util.c with-readline.1
     with-readline.c with-readline.h


2005-03-26 16:23:35 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-34

    Summary:
      release 0.1
    Revision:
      with-readline--dev--0--patch-34

    * Makefile.am: echo-distdir emits stem of tarball name
    * README: ages since last tested outside Linux/Darwin, so sound less
      certain about other UNIXes.
    * with-readline.1: spelling corrections
    * scripts/dist: adapted from DisOrder's dist script
    * configure.ac: change version number to 0.1

    new files:
     scripts/dist

    modified files:
     ChangeLog.d/with-readline--dev--0 Makefile.am README
     configure.ac with-readline.1


2005-03-26 15:44:59 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-33

    Summary:
      terminal resize bugfixes
    Revision:
      with-readline--dev--0--patch-33

    * with-readline.c: check terminal resize on SIGCONT
    
    * with-readline.c: clear Readline's notion of the input line after
      processing it.  Otherwise if you resize before any characters have been
      typed it still believes it is in the middle of editing and redisplays
      the last line.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-26 15:39:13 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-32

    Summary:
      more internal docs
    Revision:
      with-readline--dev--0--patch-32

    * design.txt: more notes

    modified files:
     ChangeLog.d/with-readline--dev--0 design.txt


2005-03-26 15:30:45 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-31

    Summary:
      ^S/^Q notes
    Revision:
      with-readline--dev--0--patch-31

    * design.txt: notes on ^S/^Q

    modified files:
     ChangeLog.d/with-readline--dev--0 design.txt


2005-03-26 15:24:32 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-30

    Summary:
      documentation updates
    Revision:
      with-readline--dev--0--patch-30

    * design.txt: add an incomplete section about special keys
    * with-readline.1: add a list of diagnostics

    modified files:
     ChangeLog.d/with-readline--dev--0 design.txt with-readline.1


2005-03-25 19:09:51 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-29

    Summary:
      SIGTTIN notes
    Revision:
      with-readline--dev--0--patch-29

    * design.txt: notes about SIGTTIN.  Not implemented yet and fiddlier than
      I first thought.

    modified files:
     ChangeLog.d/with-readline--dev--0 design.txt with-readline.c


2005-03-19 23:37:42 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-28

    Summary:
      strict security checking
    Revision:
      with-readline--dev--0--patch-28

    * with-readline.c: stricter pty permission checking: group write is only
      allowed if the pty's group ID is 'tty'.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c
     with-readline.h


2005-03-19 23:30:37 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-27

    Summary:
      explicitly initialize readline
    Revision:
      with-readline--dev--0--patch-27

    * with-readline.c: explicitly initialize readline; the manual says this
      is "not strictly necessary" but it is not strictly accurate.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-19 23:24:18 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-26

    Summary:
      improve BSD-style pty handling
    Revision:
      with-readline--dev--0--patch-26

    * with-readline.c: check terminal owner and permissions.
    * pty-bsd.c: don't check that we are running as root.
    
    Thus it should be possible to run on platforms with an openpty() that
    doesn't depend on being root to operate correctly (although I don't know
    of any such platforms).  The other effect is that the error message you
    get when with-readline is wrongly installed is a bit scarier.

    modified files:
     ChangeLog.d/with-readline--dev--0 pty-bsd.c with-readline.c
     with-readline.h


2005-03-19 19:52:08 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-25

    Summary:
      correct mad EOF bug
    Revision:
      with-readline--dev--0--patch-25

    * with-readline.c: EOF is 1 byte, not whatever other nonsense happens to
      be in c_cc.  Oops!

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-19 19:14:53 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-24

    Summary:
      signal handling
    Revision:
      with-readline--dev--0--patch-24

    * with-readline.c: clean up on fatal signals, and inhibit Readline from
      installing its own handlers.
      Do our own terminal cleanup instead of calling Readline.
      Close the has-the-child-started pipe after we're done with it.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-19 12:51:03 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-23

    Summary:
      redesign
    Revision:
      with-readline--dev--0--patch-23

    * with-readline.c: move event loop around as described in design.txt: we
      now wait for input until the user presses a key, then enter readline,
      but return to the event loop from inside it so we can continue to
      handle output from the subprocess.
      Sequences of more than one input character now work properly.
      We handle EOF by just sending the EOF character.  TIOCREMOTE might have
      been better (or not?) but doesn't exist in Linux in any case.
      All this means we're not using the callback interface to Readline any
      more.  It is doing its own signal handling still however which might
      not be right.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-16 22:37:17 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-22

    Summary:
      fix option parsing
    Revision:
      with-readline--dev--0--patch-22

    * with-readline.c: prevent getopt_long() from reordering options
    * with-readline.1: remove note about -- as it is no longer required

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.1
     with-readline.c


2005-03-16 22:34:01 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-21

    Summary:
      buffer type
    Revision:
      with-readline--dev--0--patch-21

    * buffer.c: buffer type
    * with-readline.c: use buffer type
    * design.txt: notes for how I'm going to make this actually work properly

    new files:
     buffer.c design.txt

    modified files:
     ChangeLog.d/with-readline--dev--0 Makefile.am with-readline.c
     with-readline.h


2005-03-15 19:34:19 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-20

    Summary:
      job control
    Revision:
      with-readline--dev--0--patch-20

    * with-readline.c: restore terminal settings on SIGCONT.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-13 20:27:04 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-19

    Summary:
      improved terminal handling (part 1)
    Revision:
      with-readline--dev--0--patch-19

    * with-readline.c: Put subprocess into a new session, so it can pick up
      the pty as its controlling terminal.  (Where available we call the
      ioctl for this.)
    
      Intercept the INTR and QUIT keys, so that we can pass them straight to
      the psuedo-terminal.  For INTR this means that the signal goes to the
      command and its descendants; before the above change it did anyway so
      this is just maintaining existing function (although now the
      consequences of pressing ^C are a little more verbose).  For QUIT it
      means that the signal goes to the command rather than to with-readline,
      which is new but probably what you really wanted.
    
      SUSP remains to consider, as does documentation.
    
      To make all this work we mess around with the terminal settings and
      override readline's notion of how to read a character.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-13 19:35:02 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-18

    Summary:
      work on Darwin again
    Revision:
      with-readline--dev--0--patch-18

    * with-readline.c: No longer get a slave FD back from make_terminal().
      The previous approach was causing the close of the slave to hang under
      Darwin.
    * pty-bsd.c, pty-unix98.c: close the slave FD.

    modified files:
     ChangeLog.d/with-readline--dev--0 pty-bsd.c pty-unix98.c
     with-readline.c with-readline.h


2005-03-13 18:48:01 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-17

    Summary:
      --application; docs
    Revision:
      with-readline--dev--0--patch-17

    * README: sftp makes a much better example than cat.
              Point out setuid requirement on BSD systems.
    * with-readline.c: --application option
    * with-readline.1: document --application

    modified files:
     ChangeLog.d/with-readline--dev--0 README with-readline.1
     with-readline.c


2005-03-13 18:06:57 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-16

    Summary:
      build on darwin again
    Revision:
      with-readline--dev--0--patch-16

    * with-readline.h: libutil has an xrealloc too, use a macro to avoid
      clashing.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.h


2005-03-13 18:01:54 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-15

    Summary:
      readline interfacing fixes
    Revision:
      with-readline--dev--0--patch-15

    * with-readline.c: set Readline application name.  Tell Readline about
      window size changes.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-13 17:52:26 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-14

    Summary:
      don't add blank lines to history
    Revision:
      with-readline--dev--0--patch-14

    * with-readline.c: don't add blank lines to history
    * util.c: xrealloc() is error-checking unambiguous realloc() wrapper

    modified files:
     ChangeLog.d/with-readline--dev--0 util.c with-readline.c
     with-readline.h


2005-03-13 17:42:53 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-13

    Summary:
      cope with window size changes
    Revision:
      with-readline--dev--0--patch-13

    * with-readline.c: propagate window size changes to the command.  Uses
      new signal pipe infrastructure to pick up SIGWINCH.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-13 17:20:02 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-12

    Summary:
      application-supplied prompts
    Revision:
      with-readline--dev--0--patch-12

    * with-readline.c: support for application-supplied prompts.  This is
      quite fiddly.
    
      We implement it by monitoring the command's output and treating the
      latest incomplete line as the prompt.  Thus the command's output is
      filtered entirely through with-readline.  We turn of echoing on the
      terminal so that we don't get user input echoed back to them twice
      (Readline having already printed it as they typed it).
    
      So that Readline always knows what the prompt is, we only install the
      callback when we have some user input.  The assumption is that the user
      only starts typing when they see the prompt.  This may not be true but
      they were going to get a mess then anyway so it is relatively academic.
    
      We prep the terminal at the start and inhibit Readline from prepping or
      deprepping it itself.

    modified files:
     ChangeLog.d/with-readline--dev--0 README with-readline.c


2005-03-13 15:23:26 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-11

    Summary:
      working again on darwin
    Revision:
      with-readline--dev--0--patch-11

    * configure.ac: Don't seek -lcurses on Darwin as it screws up linking.
                    Correct pty acquisition method logic for BSD

    modified files:
     ChangeLog.d/with-readline--dev--0 configure.ac


2005-03-13 15:07:46 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-10

    Summary:
      HPUX support
    Revision:
      with-readline--dev--0--patch-10

    Amazingly not everyone has strsignal() yet.
    
    * strsignal.c: borrowed from gcc libiberty
    * configure.ac: replace strsignal() if missing
    * pty-unix98.c: correct check for I_PUSH
    * with-readline.h: declare strsignal() if missing

    new files:
     strsignal.c

    modified files:
     ChangeLog.d/with-readline--dev--0 configure.ac pty-unix98.c
     with-readline.h


2005-03-13 14:24:46 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-9

    Summary:
      AIX support
    Revision:
      with-readline--dev--0--patch-9

    * configure.ac: Move check for libcurses to the right place
                    AIX doesn't like I_PUSH calls either.
                    Determine PTMX_PATH here (AIX has to be different).

    modified files:
     ChangeLog.d/with-readline--dev--0 configure.ac with-readline.h


2005-03-13 14:05:08 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-8

    Summary:
      STREAMS support.
    Revision:
      with-readline--dev--0--patch-8

    * configure.ac: Check for libcurses and <stropts.h>
                    Suppress STREAMS ioctls on Linux
    * pty-unix98.c: Push STREAMS modules onto slave pty.  We pass the slave
                    FD back to the caller now, although it currently doesn't
                    do much with it.
    * pty-bsd.c: Pass back slave pty file descriptor.
    * with-readline.c: Typo fix plus changes to support the above.
    * with-readline.h: Include <stropts.h>.

    modified files:
     ChangeLog.d/with-readline--dev--0 configure.ac pty-bsd.c
     pty-unix98.c with-readline.c with-readline.h


2005-03-13 12:24:49 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-7

    Summary:
      documentation
    Revision:
      with-readline--dev--0--patch-7

    * with-readline.1: document options and exit status
    * README: describe with-readline, sketch installation instructions

    new files:
     README

    modified files:
     ChangeLog.d/with-readline--dev--0 Makefile.am with-readline.1
     with-readline.c


2005-03-13 12:04:41 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-6

    Summary:
      set-id fixes
    Revision:
      with-readline--dev--0--patch-6

    * with-readline.c: Remember to surrender set-id even when not making a pty
                       Move terminal settings pickup to after surrender

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-12 18:55:17 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-5

    Summary:
      more hassle-free BSD support
    Revision:
      with-readline--dev--0--patch-5

    * configure.ac: choose pty acquisition method here rather than
      with-readline.h.  Also decide whether to make the executable setuid.
    * with-readline.h: no longer decide pty acquisition here.
    * Makefile.am: make installed executable setuid on BSD.

    modified files:
     ChangeLog.d/with-readline--dev--0 Makefile.am configure.ac
     with-readline.h


2005-03-12 18:36:33 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-4

    Summary:
      insist that BSD ptys be opened safely
    Revision:
      with-readline--dev--0--patch-4

    * pty-bsd.c: abort if we do not have euid root.  Insanely, openpty()
      ignores chown/chmod failing.

    modified files:
     ChangeLog.d/with-readline--dev--0 pty-bsd.c


2005-03-12 18:25:07 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-3

    Summary:
      BSD pty fixes
    Revision:
      with-readline--dev--0--patch-3

    * with-readline.c: surrender setuid/setgid privilege, for platforms where
      you need to be setuid (or setgid) to safely acquire a pty.  Annoyingly
      you can still unsafely acquire a pty without error on such platforms.

    modified files:
     ChangeLog.d/with-readline--dev--0 with-readline.c


2005-03-12 17:50:41 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-2

    Summary:
      fixes and FreeBSD support
    Revision:
      with-readline--dev--0--patch-2

    * Makefile.am: distribute man page; include getopt*
    * with-readline.h: move readline includes to the end since they break on
      FreeBSD otherwise.

    modified files:
     ChangeLog.d/with-readline--dev--0 Makefile.am with-readline.h


2005-03-12 17:41:30 GMT	Richard Kettlewell <rjk@greenend.org.uk>	patch-1

    Summary:
      darwin port
    Revision:
      with-readline--dev--0--patch-1

    Now works on Apple Darwin.
    
    * scripts/prepare: Only create config.aux if not exists.
    * configure.ac: Get check for -lutil right way round.
    * with-readline.c: Finish up when we get EOF on pty master
                       Guarantee that pty slave is open before proceeding to
                       event loop.

    modified files:
     ChangeLog.d/with-readline--dev--0 configure.ac scripts/prepare
     with-readline.c


2005-03-12 13:36:08 GMT	Richard Kettlewell <rjk@greenend.org.uk>	base-0

    Summary:
      initial import
    Revision:
      with-readline--dev--0--base-0

    Works on Linux.

    new files:
     ChangeLog.d/with-readline--dev--0 Makefile.am acinclude.m4
     configure.ac pty-bsd.c pty-unix98.c scripts/prepare util.c
     with-readline.1 with-readline.c with-readline.h


